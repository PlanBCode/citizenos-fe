<div id="topics_admin_root" *ngIf="topic$ | async as topic;">

  <topic-timeline [status]="topic.status" [voteEndsAt]="topic.vote ? topic.vote.endsAt : null"></topic-timeline>

  <div class="content_wrap">

      <!--topic-tabs topic-id="topic.id" vote-id="topic.voteId || topic.vote.id" status="topic.status"></!--topic-tabs-->

      <div class="content">
          <div class="main_panel">
              <div class="info_bar_wrap" *ngIf="editMode && showInfoEdit && TopicService.canEditDescription(topic)">
                  <div class="info_bar bar_blue info_bar_show">
                      <div class="info_icon">
                          <div class="sprite sprite-icon-notification-info2x"></div>
                      </div>

                      <div class="info_bar_text">
                          <div class="info_row">
                              <span translate="VIEWS.TOPICS_TOPICID.TAB_INFO_TXT_EDIT">You are now in edit mode. You can add text or make changes to it</span>
                          </div>
                      </div>

                      <div class="info_icon" ng-click="hideInfoEdit()">
                          <div class="sprite sprite-icon-closemenu2x"></div>
                      </div>
                  </div>
              </div>

              <div class="info_bar_wrap" *ngIf="TopicService.canEdit(topic) && (topic.status === TopicService.STATUSES.voting) "> <!--&& !('topics.view.votes' | includedByState)-->
                  <div class="info_bar bar_green info_bar_show">
                      <div class="info_icon">
                          <div class="sprite sprite-icon-notification-check2x"></div>
                      </div>

                      <div class="info_bar_text">
                          <div class="info_row">
                              <span translate="VIEWS.TOPICS_TOPICID.TAB_INFO_TXT_VOTE"></span>
                          </div>
                      </div>
                  </div>
              </div>
              <!-- Show this in 2 cases - topic has been moderated OR topic has been reported && User is a moderator -->
              <!-- topic.report.type is returned for Moderators only -->
              <!-- topic.report.moderatedReasonType is returned in case Topic has been moderated -->
              <div class="info_bar_wrap" *ngIf="topic.report && (topic.report.moderatedReasonType || (topic.report.type && !topic.report.moderatedReasonType))">
                  <div class="info_bar bar_red info_bar_show">
                      <div class="info_icon">
                          <div class="sprite sprite-icon-notification-info2x"></div>
                      </div>

                      <div class="info_bar_text">
                          <div class="info_row">
                              <span translate="VIEWS.TOPICS_TOPICID.TAB_INFO_TXT_REPORTED"></span>&nbsp;<a ng-click="doShowReportOverlay()" href=""
                                                                                                                                        translate="VIEWS.TOPICS_TOPICID.TAB_INFO_LNK_VIEW_REPORT_DETAILS"></a>
                              <span *ngIf="topic.report.type && !topic.report.moderatedReasonType">&nbsp;<a ui-sref="topics/view/reportsModerate({topicId: topic.id, reportId: topic.report.id})"
                                                                                                            ui-sref-opts="{reload:false}" translate="VIEWS.TOPICS_TOPICID.TAB_INFO_LNK_MODERATE"></a></span>
                              <span *ngIf="topic.report.type">&nbsp;<a ui-sref="topics/view/reportsResolve({topicId: topic.id, reportId: topic.report.id})" ui-sref-opts="{reload:false}"
                                                                       translate="VIEWS.TOPICS_TOPICID.TAB_INFO_LNK_RESOLVE"></a></span>
                              <span *ngIf="TopicService.canEdit(topic) && topic.report.moderatedReasonType">&nbsp;<a ui-sref="topics/view/reportsReview({topicId: topic.id, reportId: topic.report.id})"
                                                                                                         ui-sref-opts="{reload:false}"
                                                                                                         translate="VIEWS.TOPICS_TOPICID.TAB_INFO_LNK_SUBMIT_FOR_REVIEW"></a></span>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="main_content_wrap" ng-click="app.topicsSettings = false">

                  <!-- Create a milestone -->
                  <!--topic-milestones *ngIf="('topics/view/followUp' | isState) && TopicService.canEdit(topic)"></!--topic-milestones-->

                  <!-- Cast your vote container-->
                  <!--topic-vote-cast *ngIf="('topics/view/votes/view' | isState) && topic.vote.id" vote="topic.vote"></!--topic-vote-cast-->

                  <!--topic-vote-create *ngIf="showVoteCreateForm" topic-id="topic.id"></!--topic-vote-create-->


                  <div class="iframe_content_wrap" > <!--*ngIf="!('topics/view/followUp' | isState)"-->

                      <div class="topic_info print_never" *ngIf="!editMode">
                          <div class="container_visibility" >
                              <div class="ff_table_fix" [tooltip]="('TOOLTIP_TOPIC_VISIBILITY_'+topic.visibility | uppercase) | translate">
                                  <div class="table_cell">
                                      <div class="sprite" [ngClass]="{'sprite-icon-public-topic': !TopicService.isPrivate(topic), 'sprite-icon-private-topic': TopicService.isPrivate(topic)}"></div>
                                  </div>
                              </div>
                          </div>
                          <div class="container_report" *ngIf="topic.visibility === TopicService.VISIBILITY.public && !topic.report" ui-sref="topics/view/report">
                              <div class="ff_table_fix" [tooltip]="('TOOLTIP_REPORT_TOPIC'| translate)">
                                  <div class="table_cell">
                                      <div class="sprite sprite-icon-exclamation2x-white"></div>
                                      <div class="red_bg"></div>
                                  </div>
                              </div>
                          </div>

                          <div class="container_pin" ng-class="topic.pinned ? 'pinned' : ''" ng-click="togglePin()">
                              <div class="ff_table_fix" [tooltip]="('TOOLTIP_PIN_TOPIC'| translate)">
                                  <div class="table_cell">
                                      <div class="sprite sprite-icon-favourite2x-white"></div>
                                      <div class="yellow_bg"></div>
                                  </div>
                              </div>
                          </div>

                          <div class="more_info_button" ng-click="app.more_info_button = !app.more_info_button">

                              <div class="table_cell">
                                  <div class="more_info_button_text_wrap">
                                      <div class="arrow_down_wrap">
                                          <div class="arrow_down_blue sprite sprite-dropdown-arrowdown-blue2x"></div>
                                      </div>
                                      <span translate="VIEWS.TOPICS_TOPICID.LNK_TOPIC_DETAILS"></span>
                                  </div>
                                  <div class="more_info_attachment_wrap">
                                      <div class="more_info_attachment_icon sprite sprite-icon-attachment"></div>
                                      <!--span class="more_info_attachment_count">{{topicAttachments.length}}</!--span-->
                                  </div>
                              </div>
                          </div>

                          <div class="info_sections_wrap" *ngIf="wWidth > 767"> <!--|| app.more_info_button-->
                              <div class="info_section">
                                  <div class="info_section_title">
                                      <span translate="VIEWS.TOPICS_TOPICID.LBL_CATEGORIES"></span>
                                  </div>
                                  <div class="info_section_content">
                                      <!--span ng-repeat="category in topic.categories">
                                          <span translate="{{'TXT_TOPIC_CATEGORY_' + category | uppercase}}" translate-default="{{category}}">Poliitika</span>
                                          <span *ngIf="!$last" class="info_section_separator"> | </span>
                                      </!--span-->
                                      <span *ngIf="!topic.categories.length" translate="VIEWS.TOPICS_TOPICID.LBL_NO_CATEGORIES">
                                          <span *ngIf="TopicService.canEdit(topic)" class="blue_link" ui-sref="topics/view/settings({topicId: topic.id, tab: 'categories'})"
                                                translate="VIEWS.TOPICS_TOPICID.LNK_ADD_CATEGORIES">add categories</span>
                                      </span>
                                  </div>
                              </div>
                              <div class="info_section">
                                  <div class="info_section_title">
                                      <span translate="VIEWS.TOPICS_TOPICID.LBL_AUTHORS" [translateParams]="{topic: topic}"></span>
                                  </div>
                                  <!--div class="info_section_content"><span ng-repeat="author in topic.authors" *ngIf="author.email" class="blue_link"
                                                                          tooltips tooltip-class="tooltip_author"
                                                                          tooltip-template="<span class='creator_data_tooltip_row'>{{author.email}}</span><span class='creator_data_tooltip_row'>{{author.phoneNumber}}</span>"
                                                                          tooltip-smart="true">{{author.name}}<span *ngIf="!$last" class="info_section_separator"> | </span></span><span ng-repeat="author in topic.authors" *ngIf="!author.email">{{author.name}}<span *ngIf="!$last" class="info_section_separator"> | </span></span>
                                  </!--div-->
                              </div>
                              <div class="info_section">
                                  <div class="info_section_title">
                                      <span translate="VIEWS.TOPICS_TOPICID.LBL_ACTIVITY"></span>
                                  </div>
                                  <div class="info_section_content">
                                      <span class="blue_link" ng-click="app.activeCommentSection = 'arguments'; app.scrollToAnchor('arguments')"
                                            translate="VIEWS.TOPICS_TOPICID.LNK_ARGUMENTS_COUNT"
                                            [translateParams]="{count: TopicArgumentService.count.value.total || 0}"></span>
                                      <span class="info_section_separator"> | </span>
                                      <span class="blue_link" ng-click="app.activeCommentSection = 'socialMentions'; app.scrollToAnchor('socialMentions')"
                                            translate="VIEWS.TOPICS_TOPICID.LNK_MENTIONS_COUNT"
                                            [translateParams]="{mentionsCount: (topicSocialMentions.length ||0)}"></span>
                                      <span *ngIf="!topic.hashtag && TopicService.canEdit(topic)" class="info_section_separator"> | </span>
                                      <span class="blue_link" *ngIf="!topic.hashtag && TopicService.canEdit(topic)"
                                            ui-sref="topics/view/settings({topicId: topic.id, tab: 'settings'})"
                                            translate="VIEWS.TOPICS_TOPICID.LNK_MENTIONS_COUNT_ADD_HASHTAG"></span>
                                      <span *ngIf="topic.hashtag" class="black_text" ng-bind="('#'+topic.hashtag)"> </span>
                                  </div>
                              </div>
                              <div class="info_section" *ngIf="wWidth < 767">
                                  <div class="info_section_title">
                                      <span translate="VIEWS.TOPICS_TOPICID.LBL_ATTACHMENTS"></span>
                                  </div>
                                  <div class="info_section_content">
                                      <!--div class="blue_link" ng-repeat="attachment in topicAttachments">
                                          <a *ngIf="attachment.source === ATTACHMENT_SOURCES.upload" class="blue_link info_section_attachment"
                                             ng-click="$event.preventDefault(); downloadAttachment(attachment);" href="{{attachment.link}}">{{attachment.name}}<span
                                              class="btn blue_button file_type">.{{attachment.type}}</span></a>
                                          <a *ngIf="attachment.source !== ATTACHMENT_SOURCES.upload" class="blue_link info_section_attachment" target="_blank" href="{{attachment.link}}">{{attachment.name}} <span
                                              class="btn blue_button file_type">{{attachment.type}}</span></a>
                                      </!--div-->
                                      <div ui-sref="topics/view/files" *ngIf="TopicService.canEdit(topic)" class="blue_link info_section_add_attachments"
                                           translate="VIEWS.TOPICS_TOPICID.LNK_ADD_MANAGE_FILES">
                                      </div>
                                  </div>
                              </div>
                          </div>

                          <div class="line lightest_line"></div>
                      </div>


                      <div id="topic_content_area" class="topic_content">
                          <!--iframe cos-etherpad *ngIf="!hideTopicContent && TopicService.canEdit(topic) && app.editMode" frameborder="0" scrolling="no"
                                  ng-class="{hidden: !topic.padUrl || ('topics.view.followUp' | isState)}"
                                  ng-src="{{topic.padUrl}}" width="100%" height="600"></!--iframe-->
                          <!--ng-bind-html *ngIf="!hideTopicContent && !app.editMode" ng-bind-html="topic.description"></ng-bind-html -->
                          <div *ngIf="!hideTopicContent && !editMode" [innerHtml]="topic.description"></div>
                          <h1 *ngIf="hideTopicContent"><i>Topic content has been hidden due to violation of community guidelines</i></h1>
                      </div>

                  </div>

                  <div class="comments_section print_never">
                      <div class="tabs_wrap">
                          <div ng-click="app.activeCommentSection = 'arguments'" class="tab"
                               ng-class="app.activeCommentSection == 'arguments' || app.activeCommentSection == undefined ? 'active':''">
                              <div class="table_cell" translate="VIEWS.TOPICS_TOPICID.LBL_TAB_ARGUMENTS"></div>
                          </div>
                          <div ng-click="app.activeCommentSection = 'socialMentions'" class="tab" ng-class="app.activeCommentSection == 'socialMentions' ? 'active':''">
                              <div class="table_cell" translate="VIEWS.TOPICS_TOPICID.LBL_TAB_MENTIONS"></div>
                          </div>
                      </div>
                      <div class="clearer"></div>
                      <div class="comments_content">
                          <topic-arguments *ngIf="activeCommentSection == 'arguments' || activeCommentSection == undefined" ></topic-arguments>
                          <!--topic-social-mentions-- *ngIf="app.activeCommentSection == 'socialMentions'"></!--topic-social-mentions-->
                      </div>
                  </div>

              </div>

          </div>

          <!--topic-sidepanel class="side_panel print_never" *ngIf="app.wWidth > 1024 || app.topicsSettings"></!--topic-sidepanel-->
      </div>

  </div>

  <div class="side_panel_background">
  </div>

  <div ui-view></div>

  <div class="print_footer" *ngIf="topic">
      <!--div class="qr_code" *ngIf="app.currentUrlAbs">
          <qrcode data="{{app.currentUrlAbs}}" size="210" version="12" error-correction-level="L" download class="qr_img"></qrcode>
      </!--div-->
      <!--span translate="VIEWS.TOPICS_TOPICID.TXT_QR_CODE_FOOTER_SCAN_CODE" [translateParams]="{topicTitle: topic.title}">Jump right into the topic <b>{{topicTitle}}</b> by scanning this QR code!</!--span-->
      <!--a ng-href="app.currentUrlAbs">{{app.currentUrlAbs}}</!--a-->
  </div>
</div>
