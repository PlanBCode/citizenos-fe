<!-- LIGHTBOX SKELETON -->
<div id="root_lightbox" class="full_screen">

  <div id="lightbox" class="wide_lightbox with_title_description with_header_menu member_lightbox">
    <div id="lightbox_wrap">

      <div id="lightbox_header">

        <div id="lightbox_header_text">
          <div class="title" translate="MODALS.TOPIC_MEMBERS_HEADING"></div>
          <div class="title_description">{{topic.title}}</div>
        </div>

        <div id="lightbox_close" mat-dialog-close>
          <div class="table_cell ngdialog-close">
            <div class="sprite sprite-btn-popup-close2x ngdialog-close">
            </div>
          </div>
        </div>

        <div class="clearer"></div>

        <div class="header_row_wrap">
          <div class="header_row" slide-controller identifier="topicSettingsSlider">
            <div class="tab_button" (click)="selectTab('participants')"
              [ngClass]="tabSelected === 'participants' ? 'active' : ''">
              <div class="tab_buttom_wrap">
                <div class="tab_button_text" translate="MODALS.TOPIC_MEMBERS_TAB_PARTICIPANTS"></div>
                <div class="blue_bottom_line"></div>
              </div>
            </div>
            <div class="tab_button" (click)="selectTab('groups')" [ngClass]="tabSelected === 'groups' ? 'active' : ''">
              <div class="tab_buttom_wrap">
                <div class="tab_button_text" translate="MODALS.TOPIC_MEMBERS_TAB_GROUPS"></div>
                <div class="blue_bottom_line"></div>
              </div>
            </div>
            <div class="tab_button" (click)="selectTab('invited')"
              [ngClass]="tabSelected === 'invited' ? 'active' : ''">
              <div class="tab_buttom_wrap">
                <div class="tab_button_text" translate="MODALS.TOPIC_MEMBERS_TAB_INVITED"></div>
                <div class="blue_bottom_line"></div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="line lightest_line"></div>
      <!-- PARTICIPANTS USERS -->
      <div class="lightbox_content settings_section_wrap padding_bottom_zero" *ngIf="tabSelected === 'participants'">
        <div class="lightbox_section">
          <table>
            <tr>
              <td>
                <input [placeholder]="('MODALS.TOPIC_MEMBERS_PLACEHOLDER_NAME_PERMISSION' | translate)"
                  (ngModelChange)="TopicMemberUserService.setParam('search', TopicMemberUserService.params.search)"
                  [(ngModel)]="TopicMemberUserService.params.search">
              </td>
            </tr>
          </table>
        </div>
        <ng-container *ngIf="memberUsers$ | async as memberUsers">
          <div class="lightbox_section participants_list" *ngIf="TopicMemberUserService.countTotal$ | async">
            <table>
              <tr>
                <th (click)="TopicMemberUserService.doOrder('name')">
                  <div class="th_text">
                    <span translate="MODALS.TOPIC_MEMBERS_LNK_PROFILE"></span>
                    <div
                      [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicMemberUserService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicMemberUserService.params.order === 'DESC' }"
                      *ngIf="TopicMemberUserService.params.orderBy === 'name'"></div>
                  </div>
                </th>
                <th (click)="TopicMemberUserService.doOrder('level')">
                  <div class="th_text">
                    <span translate="MODALS.TOPIC_MEMBERS_LNK_ROLES"></span>
                    <div
                      [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicMemberUserService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicMemberUserService.params.order === 'DESC' }"
                      *ngIf="TopicMemberUserService.params.orderBy === 'level'"></div>
                  </div>
                </th>
                <th class="not_sortable">
                  <div class="th_text">
                  </div>
                </th>
              </tr>
              <topic-member-user class="pretend_tr" *ngFor="let user of memberUsers" [member]="user" [topic]="topic"
                fields="['level', 'remove']"></topic-member-user>
              <!--tr [ngClass]="{'with_padding': $first}" *ngFor="let user of memberUsers$ | async; let $first = first;">
              <td>
                <div class="profile_image_wrapper dark">
                  <!--div class="profile_moon sprite sprite-icon-certified-fb2x"></div>
                  <div class="account_picture">
                    <img *ngIf="user.imageUrl" [src]="user.imageUrl">
                    <div *ngIf="!user.imageUrl" class="profile_image_filler">
                      <cos-initials class="table_cell" [(ngModel)]="user.name"></cos-initials>
                      <div class="profile_circle"></div>
                    </div>
                  </div>
                </div>

                <div class="name_wrap">
                  <div class="table_cell">
                    <div [innerText]="user.name"
                      [tooltip]="'<span class=\'creator_data_tooltip_row\'>'+user.email+'</span><span class=\'creator_data_tooltip_row\'>'+user.phoneNumber+'</span><span class=\'creator_data_tooltip_row\'>'+user.pid+'</span>'">
                    </div>
                    <div class="via" *ngIf="user.email">
                      <span [innerText]="user.email"></span>
                    </div>
                    <div class="via" *ngIf="user.groups.rows.length && !user.levelUser">
                      <span translate="MODALS.TOPIC_MEMBERS_LBL_VIA">via</span> <span
                        *ngFor="let group of user.groups.rows; let $first = first;"><span *ngIf="!$first">, </span><span
                          *ngIf="group.name" class="blue_link"
                          ui-sref="my/groups/groupId({groupId: group.id, filter: 'grouped'})">{{group.name}}
                          ({{'TXT_TOPIC_LEVELS_' + group.level | uppercase | translate}})</span><i *ngIf="!group.name"
                          class="disabled" translate="MODALS.TOPIC_MEMBERS_LBL_INACCESSIBLE_GROUP"
                          [translateParams]="{level: ('TXT_TOPIC_LEVELS_' + group.level | uppercase | translate)}"></i>
                        <i class="disabled">(<span
                            translate="{{'TXT_TOPIC_LEVELS_' + group.level | uppercase }}">admin</span>)</i></span>
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <div cos-dropdown class="classic_dropdown" *ngIf="canUpdate()">
                  <div class="dropdown_selection">
                    <div class="dropdown_text">{{'TXT_TOPIC_LEVELS_' + user.level | uppercase | translate}}</div>

                    <div class="arrow_holder">
                      <div class="table_cell">
                        <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                        <div class="v_line"></div>
                      </div>
                    </div>
                  </div>
                  <div class="dropdown">
                    <div class="dropdown_item" *ngFor="let level of LEVELS">
                      <div class="item_name" (click)="doUpdateMemberUser(user, level)">{{'TXT_TOPIC_LEVELS_' +
                        level | uppercase | translate}}</div>
                    </div>
                  </div>
                </div>
                <span *ngIf="!canUpdate()" class="user_level_text">{{'TXT_TOPIC_LEVELS_' +
                  user.level | uppercase | translate}}</span>
              </td>
              <td class="recycle_bin_wrap" *ngIf="canUpdate()">
                <div class="btn_wrap recycle_bin" *ngIf="user.levelUser">
                  <div class="btn" (click)="doDeleteMemberUser(user)">
                    <div class="table_cell">
                      <div class="sprite desktop_fix sprite-mytopics-icon-deletetopic2x"></div>
                      <div class="sprite mobile_fix sprite-mytopics-icon-deletetopic2x"></div>
                    </div>
                  </div>
                </div>
              </td>
            </!--tr-->
            </table>
            <div class="pagination_row">
              <div class="pagination_wrapper">
                <cos-pagination class="pagination" (select)="TopicMemberUserService.loadPage($event)"
                  [totalPages]="(TopicMemberUserService.totalPages$ | async) || 0"
                  [page]="(TopicMemberUserService.page$ | async) || 0"></cos-pagination>
              </div>
            </div>
          </div>

        </ng-container>
      </div>

      <!-- GROUPS -->
      <div class="lightbox_content settings_section_wrap padding_bottom_zero" *ngIf="tabSelected === 'groups'">
        <div class="lightbox_section">
          <table>
            <tr>
              <td>
                <input [placeholder]="'MODALS.TOPIC_MEMBERS_PLACEHOLDER_TOPIC_TITLE_PERMISSION' | translate"
                  (change)="TopicMemberGroupService.setParam('search', TopicMemberGroupService.params.search)"
                  [(ngModel)]="TopicMemberGroupService.params.search">
              </td>
            </tr>
          </table>
        </div>
        <ng-container *ngIf="memberGroups$ | async as memberGroups">
          <div class="lightbox_section participants_list" *ngIf="TopicMemberGroupService.countTotal$ | async">

            <table>
              <tr>
                <th (click)="TopicMemberGroupService.doOrder('name')">
                  <div class="th_text">
                    <span translate="MODALS.TOPIC_MEMBERS_LNK_NAME"></span>
                    <div
                      [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicMemberGroupService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicMemberGroupService.params.order === 'DESC' }"
                      *ngIf="TopicMemberGroupService.params.orderBy === 'name'"></div>
                  </div>
                </th>
                <th (click)="TopicMemberGroupService.doOrder('level')">
                  <div class="th_text">
                    <span translate="MODALS.TOPIC_MEMBERS_LNK_ROLES"></span>
                    <div
                      [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicMemberGroupService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicMemberGroupService.params.order === 'DESC' }"
                      *ngIf="TopicMemberGroupService.params.orderBy === 'level'"></div>
                  </div>
                </th>
                <th class="not_sortable">
                  <div class="th_text">
                  </div>
                </th>
              </tr>
              <topic-member-group [topic]="topic" [group]="group" class="pretend_tr"
                *ngFor="let group of memberGroups"></topic-member-group>
              <!--tr-- [ngClass]="{'with_padding': $first}" *ngFor="let group of memberGroups$ | async; let $first = first;">
              <td>
                <div class="blue_link" *ngIf="group.permission.level"
                  ui-sref="my/groups/groupId({groupId: group.id, filter: 'grouped'})" ui-sref-opts="{reload: true}"
                  [innerText]="group.name"></div>
                <div *ngIf="!group.permission.level"><i class="disabled"
                    translate="MODALS.TOPIC_MEMBERS_LBL_INACCESSIBLE_GROUP"></i></div>
              </td>
              <td>
                <div cos-dropdown class="classic_dropdown">
                  <div class="dropdown_selection">
                    <div class="dropdown_text">{{'TXT_TOPIC_LEVELS_' + group.level | uppercase | translate}}</div>

                    <div class="arrow_holder">
                      <div class="table_cell">
                        <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                        <div class="v_line"></div>
                      </div>
                    </div>
                  </div>
                  <div class="dropdown">
                    <div class="dropdown_item" ng-repeat="(key, level) in Topic.LEVELS">
                      <div class="item_name" (click)="doUpdateMemberGroup(group, level)">{{'TXT_TOPIC_LEVELS_' +
                        level | uppercase | translate}}</div>
                    </div>
                  </div>
                </div>
              </td>
              <td class="recycle_bin_wrap">
                <div class="btn_wrap recycle_bin" *ngIf="canUpdate()">
                  <div class="btn" (click)="doDeleteMemberGroup(group)">
                    <div class="table_cell">
                      <div class="sprite desktop_fix sprite-mytopics-icon-deletetopic2x"></div>
                      <div class="sprite mobile_fix sprite-mytopics-icon-deletetopic2x"></div>
                    </div>
                  </div>
                </div>
              </td>
            </!--tr-->
            </table>
            <div class="pagination_row">
              <div class="pagination_wrapper">
                <cos-pagination class="pagination" (select)="TopicMemberGroupService.loadPage($event)"
                  [totalPages]="(TopicMemberGroupService.totalPages$ | async) || 0"
                  [page]="(TopicMemberGroupService.page$ | async) || 0"></cos-pagination>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <div class="lightbox_content settings_section_wrap padding_bottom_zero" *ngIf="tabSelected === 'invited'">
        <div class="lightbox_section">
          <table>
            <tr>
              <td>
                <input [placeholder]="'MODALS.TOPIC_MEMBERS_PLACEHOLDER_NAME_PERMISSION' | translate"
                  (change)="TopicInviteUserService.setParam('search', TopicInviteUserService.params.search);"
                  [(ngModel)]="TopicInviteUserService.params.search">
              </td>
            </tr>
          </table>
        </div>
        <ng-container *ngIf="memberInvites$ | async as memberInvites">
        <div class="lightbox_section participants_list" *ngIf="TopicInviteUserService.countTotal$ | async">
          <!-- TopicInviteUsers -->
          <table>
            <tr>
              <th (click)="TopicInviteUserService.doOrder('name')">
                <div class="th_text">
                  <span translate="MODALS.TOPIC_MEMBERS_LNK_PROFILE"></span>
                  <div
                    [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicInviteUserService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicInviteUserService.params.order === 'DESC' }"
                    *ngIf="TopicInviteUserService.params.orderBy === 'name'"></div>
                </div>
              </th>
              <th (click)="TopicInviteUserService.doOrder('level')">
                <div class="th_text">
                  <span translate="MODALS.TOPIC_MEMBERS_LNK_ROLES"></span>
                  <div
                    [ngClass]="{'sprite sprite-icon-list-ordering2x': TopicInviteUserService.params.order === 'ASC', 'sprite sprite-icon-list-ordering-down-black2x': TopicInviteUserService.params.order === 'DESC' }"
                    *ngIf="TopicInviteUserService.params.orderBy === 'level'"></div>
                </div>
              </th>
              <th class=" not_sortable">
                <div class="th_text">
                </div>
              </th>
            </tr>
            <topic-member-invite class="pretend_tr" *ngFor="let invite of memberInvites" [invite]="invite"
              [topic]="topic" fields="['level', 'remove']"></topic-member-invite>
            <!--tr [ngClass]="{'with_padding': $first}" ng-repeat="invite in TopicInviteUserService.users">
              <td>
                <div class="profile_image_wrapper dark">
                  <div class="profile_moon sprite sprite-icon-certified-fb2x"></div>
              <div class="account_picture">
                <img *ngIf="invite.user.imageUrl" ng-src="{{invite.user.imageUrl}}">
                <div *ngIf="!invite.user.imageUrl" class="profile_image_filler">
                  <cos-initials class="table_cell" [(ngModel)]="invite.user.name"></cos-initials>
                  <div class="profile_circle"></div>
                </div>
              </div>
            </div>
            <div class="name_wrap">
              <div class="table_cell smooth_gray">
                <div [innerText]="invite.user.name" tooltips
                  tooltip-hidden="{{(!invite.user.email && !invite.user.pid && !invite.user.phoneNumber)}}"
                  tooltip-class="tooltip_author"
                  tooltip-template="<span class='creator_data_tooltip_row'>{{invite.user.email}}</span><span class='creator_data_tooltip_row'>{{invite.user.phoneNumber}}</span><span class='creator_data_tooltip_row'>{{invite.user.pid}}</span>"
                  tooltip-smart="true">invite.user.name</div>
                <div class="via">
                  <span translate="MODALS.TOPIC_MEMBERS_TXT_INVITE_PENDING"></span> <span
                    *ngIf="invite.user.email" [innerText]="invite.user.email"></span>
                </div>
                <div class="via error">
                  <span translate="MODALS.TOPIC_MEMBERS_TXT_INVITE_EXPIRED"></span>
                </div>
              </div>
            </div>
          </td>
          <td>
            <div cos-dropdown class="classic_dropdown">
              <div class="dropdown_selection">
                <div class="dropdown_text">{{'TXT_TOPIC_LEVELS_' + invite.level | uppercase | translate}}</div>

                <div class="dropdown">
                  <div class="dropdown_item" ng-repeat="(key, level) in Topic.LEVELS">
                    <div class="item_name" (click)="doUpdateInvite(invite, level)">{{'TXT_TOPIC_LEVELS_' + level
                      | uppercase | translate}}</div>
                  </div>
                </div>

                <div class="arrow_holder">
                  <div class="table_cell">
                    <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                    <div class="v_line"></div>
                  </div>
                </div>
              </div>
            </div>
          </td>
          <td class="recycle_bin_wrap">
            <div class="btn_wrap recycle_bin" *ngIf="canUpdate()">
              <div class="btn" (click)="doDeleteInviteUser(invite)">
                <div class="table_cell">
                  <div class="sprite desktop_fix sprite-mytopics-icon-deletetopic2x"></div>
                  <div class="sprite mobile_fix sprite-mytopics-icon-deletetopic2x"></div>
                </div>
              </div>
            </div>
          </td>
        </!--tr-->
          </table>
          <div class="pagination_row">
            <div class="pagination_wrapper">
              <cos-pagination class="pagination" (select)="TopicInviteUserService.loadPage($event)"
                [totalPages]="(TopicInviteUserService.totalPages$ | async) || 0"
                [page]="(TopicInviteUserService.page$ | async) || 0"></cos-pagination>
            </div>
          </div>
        </div>
      </ng-container>
      </div>

      <div class="lightbox_footer">
        <div class="line lightest_line"></div>
        <div class="blue_button_wrap">
          <div class="blue_button" mat-dialog-close translate="MODALS.TOPIC_MEMBERS_BTN_SAVE"></div>
        </div>
      </div>

    </div>
  </div>
  <div id="close_lightbox" class="ngdialog-close" mat-dialog-close></div>